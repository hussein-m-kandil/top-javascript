(()=>{const e="odin-library-books",t=[];class a{static#e=0;constructor(e,t,n,d){this.id=String(++a.#e),this.title=e,this.author=t,this.numOfPages=n,this.readState=Boolean(d)}setReadState(e){"boolean"==typeof e&&(this.readState=e)}}if(localStorage){const a=localStorage.getItem(e);a&&t.push(...JSON.parse(a))}function n(e,a){const n=document.createElement("div");n.className="book-card";const d=document.createElement("div").appendChild(document.createTextNode(e.title)).parentElement;d.className="book-card-title";const o=document.createElement("div");o.className="book-card-body",o.appendChild(c("Author",e.author)),o.appendChild(c("Number of Pages",e.numOfPages));const r=c("Read",e.readState?"Yes":"No");r.id="read-state-"+e.id,r.lastChild.classList.add(e.readState?"success-text":"danger-text"),o.appendChild(r);const l=document.createElement("div");l.className="book-card-buttons";const i=u("Mark as "+(e.readState?"not read":"read"),"button",e.readState?"danger-border danger-text":"success-border success-text","read-state-toggler-"+e.id,e.id);i.addEventListener("click",(e=>{const a=e.target.value;for(let n=0;n<t.length;n++)if(t[n].id===a){t[n].setReadState(!t[n].readState),t[n].readState?s(e.target,"Mark as not read","success-border","danger-border",document.querySelector("#read-state-"+a).lastChild,"Yes","danger-text","success-text"):s(e.target,"Mark as read","danger-border","success-border",document.querySelector("#read-state-"+a).lastChild,"No","success-text","danger-text");break}m(t)}));const p=u("Delete","button","danger-text danger-border","book-card-del-btn-"+e.id,e.id);p.addEventListener("click",(e=>{for(let a=0;a<t.length;a++)if(t[a].id===e.target.value){t.splice(a,1);try{document.querySelector(".books-container")?.removeChild(e.target.parentElement.parentElement)}catch(e){console.log(e.message)}break}m(t)})),l.append(i,p),n.append(d,o,l),a.insertBefore(n,a.firstChild)}function d(e){const d=document.createElement("form");d.className="new-book-form";const[o,l]=r("Title: ",[["for","title"]],[["type","text"],["id","title"],["name","title"],["autocomplete","on"],["required",""]]);window.HTMLDialogElement&&(l.autofocus=!0),d.appendChild(document.createElement("div").appendChild(o).parentElement.appendChild(l).parentElement);const[c,i]=r("Author: ",[["for","author"]],[["type","text"],["id","author"],["name","author"],["autocomplete","on"],["required",""]]);d.appendChild(document.createElement("div").appendChild(c).parentElement.appendChild(i).parentElement);const[s,p]=r("Number of Pages: ",[["for","pages-number"]],[["type","tel"],["id","pages-number"],["name","pages-number"],["pattern","^[0-9]{1,7}$"],["autocomplete","on"],["required",""]]);p.addEventListener("invalid",(e=>{e.target.validity.patternMismatch?e.target.setCustomValidity("Numbers only are allowed here."):e.target.setCustomValidity("")})),p.addEventListener("input",(e=>{e.target.checkValidity()&&e.target.validity.customError&&e.target.setCustomValidity("")})),d.appendChild(document.createElement("div").appendChild(s).parentElement.appendChild(p).parentElement);const[h,b]=r(" Did you read this book?",[["for","read-state"]],[["type","checkbox"],["id","read-state"],["name","read-state"]]);d.appendChild(document.createElement("div").appendChild(b).parentElement.appendChild(h).parentElement);const g=u("Add New Book","submit","success-color");d.appendChild(document.createElement("div").appendChild(g).parentElement),e.appendChild(d),d.addEventListener("submit",(e=>{e.preventDefault();const d=e.target.elements,o=new a(d.title.value,d.author.value,d["pages-number"].value,d["read-state"].checked);t.unshift(o),m(t),n(o,document.querySelector(".books-container"));for(let e=0;e<d.length;e++)d[e].value="","checkbox"===d[e].type&&(d[e].checked=!1);e.target.parentElement instanceof HTMLDialogElement&&e.target.parentElement.close()}))}function o(e,t){if(e&&e.setAttribute&&t&&Array.isArray(t))for(let a=0;a<t.length;a++)Array.isArray(t)&&2===t[a].length&&e.setAttribute(t[a][0],t[a][1])}function r(e,t,a){const n=document.createElement("label");e&&"string"==typeof e&&n.appendChild(document.createTextNode(e)),o(n,t);const d=document.createElement("input");return o(d,a),[n,d]}function l(e,t){const a=document.createElement("span");return a.className=t??"",a.appendChild(document.createTextNode(e??"")),a}function c(e,t){const a=document.createElement("div");return a.className="book-card-entry",a.appendChild(l(e+": ","book-card-entry-title")),a.appendChild(l(t,"book-card-entry-data")),a}function s(e,t,a,n,d,o,r,l){e.textContent=t,e.classList.replace(a,n),e.classList.replace(l,r),d.textContent=o,d.classList.replace(r,l)}function u(e,t,a,n,d){const o=document.createElement("button");return o.appendChild(document.createTextNode(e)),o.setAttribute("type",t),o.className=a??"",o.id=n??"",o.value=d??"",o}function m(t){if(localStorage){const a=JSON.stringify(t);a.length<3145728&&localStorage.setItem(e,a)}}t.length>0?t.splice(0,t.length,...t.map((e=>new a(e.title,e.author,e.numOfPages,e.readState)))):(t.push(new a("Murder On The Orient Express","Agatha Christie","256")),t.push(new a("Death on the Nile","Agatha Christie","288",!0))),document.body.appendChild(document.createElement("h1").appendChild(document.createTextNode("Odin Library")).parentElement),window.HTMLDialogElement?function(){const e=u("+","button","new-book-dialog-show-btn");e.addEventListener("click",(()=>{document.querySelector("dialog").showModal()})),o(e,[["aria-label","Add new book"],["title","Add new book"]]),document.body.appendChild(document.createElement("div").appendChild(e).parentElement);const t=document.createElement("dialog"),a=u("x","button","new-book-dialog-close-btn");o(a,[["aria-label","Close"],["title","Close"]]),t.appendChild(document.createElement("div").appendChild(a).parentElement),a.addEventListener("click",(()=>document.querySelector("dialog").close())),d(t),document.body.appendChild(t)}():d(document.body);const p=document.createElement("div");for(p.className="books-container",document.body.appendChild(p),i=t.length-1;i>=0;i--)n(t[i],p)})();